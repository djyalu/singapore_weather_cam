import{P as s,R as b,j as e,r as m}from"./index-30c7ff2b.js";import{W as I}from"./WebcamModal-98639094.js";const f=({webcam:i,onClick:x})=>{const{name:d,location:r,file_info:t,ai_analysis:l,capture_time:g,type:c}=i,[a,p]=b.useState(Date.now()),[h,n]=b.useState(!0),[o,y]=b.useState(!1),[u,R]=b.useState(0),v="/singapore_weather_cam/",N=t!=null&&t.url||t!=null&&t.source_url||t!=null&&t.path?t.url||t.source_url||`${v}${t.path}`:`${v}images/placeholder.jpg`,$=()=>{n(!1),y(!1)},S=()=>{n(!1),y(!0),u<3&&setTimeout(()=>{R(j=>j+1),p(Date.now())},1e3+u*1e3)};return b.useEffect(()=>{u>0&&(n(!0),y(!1))},[u]),b.useEffect(()=>{const j=setInterval(()=>{p(Date.now())},3e4);return()=>clearInterval(j)},[]),e.jsxs("div",{className:"card cursor-pointer hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1",onClick:x,children:[e.jsxs("div",{className:"relative",children:[h&&e.jsx("div",{className:"w-full h-48 bg-gray-200 rounded-md mb-4 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500 text-sm",children:"로딩 중..."})}),o&&u>=3&&e.jsxs("div",{className:"w-full h-48 bg-gray-100 border-2 border-dashed border-gray-300 rounded-md mb-4 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-gray-400 text-2xl mb-2",children:"📷"}),e.jsxs("div",{className:"text-gray-500 text-sm text-center",children:["이미지를 불러올 수 없습니다",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"네트워크를 확인해주세요"})]})]}),e.jsx("img",{src:`${N}${N.includes("?")?"&":"?"}t=${a}`,alt:`${d} webcam view`,className:`w-full h-48 object-cover rounded-md mb-4 transition-opacity duration-300 ${h||o?"hidden":"block"}`,loading:"lazy",onLoad:$,onError:S},a),!h&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-xs",children:new Date(g).toLocaleTimeString("en-SG")}),e.jsx("div",{className:"absolute top-2 left-2 bg-blue-600 text-white px-2 py-1 rounded text-xs capitalize",children:c}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-green-600/80 text-white px-2 py-1 rounded text-xs",children:"🔴 LIVE (30초 새로고침)"})]}),o&&u<3&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-600 text-white px-2 py-1 rounded text-xs",children:["재시도 중... (",u+1,"/3)"]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:d}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:r}),t&&e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Size: ",Math.round(t.size/1024),"KB"]}),l&&l.analysis_available&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"AI Analysis:"})," ",l.analysis]})}),l&&!l.analysis_available&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["AI Analysis: ",l.reason]})})]})};f.propTypes={webcam:s.shape({name:s.string.isRequired,location:s.string.isRequired,file_info:s.shape({source_url:s.string,url:s.string,path:s.string,size:s.number}),ai_analysis:s.shape({analysis_available:s.bool,analysis:s.string,reason:s.string}),capture_time:s.string.isRequired,type:s.string.isRequired}).isRequired,onClick:s.func.isRequired};const w=({webcam:i})=>{const{name:x,location:d,file_info:r}=i,[t,l]=m.useState(!1),[g,c]=m.useState(""),[a,p]=m.useState(new Date),h="/singapore_weather_cam/",n=(r==null?void 0:r.source_url)||(r==null?void 0:r.url)||(r!=null&&r.path?`${h}${r.path}`:`${h}images/placeholder.jpg`);return m.useEffect(()=>{let o;return t&&(o=setInterval(()=>{const y=Date.now();c(`${n}${n.includes("?")?"&":"?"}t=${y}`),p(new Date)},5e3)),()=>{o&&clearInterval(o)}},[t,n]),m.useEffect(()=>{c(`${n}${n.includes("?")?"&":"?"}t=${Date.now()}`)},[n]),e.jsxs("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("img",{src:g,alt:`${x} live view`,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-4 left-4 flex items-center space-x-2",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${t?"bg-red-600 animate-pulse":"bg-gray-600"}`}),e.jsx("span",{className:"text-white text-sm font-medium",children:t?"LIVE":"PAUSED"})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l(!t),className:"bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors",children:t?"⏸ 일시정지":"▶ 재생"}),e.jsxs("div",{className:"text-white text-sm",children:["마지막 업데이트: ",a.toLocaleTimeString("ko-KR")]})]}),e.jsx("div",{className:"absolute top-4 right-4 bg-black/50 backdrop-blur-sm text-white px-3 py-1 rounded",children:e.jsx("p",{className:"text-xs",children:d})})]}),e.jsxs("div",{className:"p-4 bg-gray-800 text-white",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:x}),e.jsx("p",{className:"text-sm text-gray-400",children:t?"5초마다 자동으로 이미지가 새로고침됩니다.":"재생 버튼을 눌러 실시간 업데이트를 시작하세요."})]})]})};w.propTypes={webcam:s.shape({name:s.string.isRequired,location:s.string.isRequired,file_info:s.shape({source_url:s.string,url:s.string,path:s.string})}).isRequired};const _=({data:i})=>{const[x,d]=m.useState(null),[r,t]=m.useState(0),[l,g]=m.useState("grid");if(!i||!i.captures||i.captures.length===0)return e.jsx("div",{className:"card",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No webcam data available"})});const c=i.captures.filter(a=>a.status==="success");return c.length===0?e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-gray-500 text-center",children:"No webcam images captured successfully"}),e.jsxs("p",{className:"text-sm text-gray-400 text-center mt-2",children:[i.failed_captures," cameras failed to capture"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Last captured: ",new Date(i.timestamp).toLocaleString("en-SG")]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.successful_captures,"/",i.total_cameras," cameras active"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>g("grid"),className:`px-3 py-1 rounded text-sm transition-colors ${l==="grid"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"📷 그리드 보기"}),e.jsx("button",{onClick:()=>g("live"),className:`px-3 py-1 rounded text-sm transition-colors ${l==="live"?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"🔴 라이브 모드"})]})]}),l==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map((a,p)=>e.jsx(f,{webcam:a,onClick:()=>{d(a),t(p)}},a.id))}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:c.map(a=>e.jsx(w,{webcam:a},a.id))})]}),x&&e.jsx(I,{item:x,items:c,currentIndex:r,type:"webcam",onClose:()=>{d(null),t(0)},onNavigate:a=>{t(a),d(c[a])}})]})};_.propTypes={data:s.shape({captures:s.arrayOf(s.shape({id:s.string.isRequired,name:s.string.isRequired,location:s.string.isRequired,file_info:s.object,ai_analysis:s.object,capture_time:s.string.isRequired,type:s.string.isRequired})).isRequired,timestamp:s.string,successful_captures:s.number,failed_captures:s.number,total_cameras:s.number}).isRequired};export{_ as default};
//# sourceMappingURL=WebcamGallery-2ef51022.js.map
